<!DOCTYPE html>
<html>
<head>
    <title>micro:bit Accéléromètre en Direct</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center;
            margin: 20px;
        }
        #data-container {
            margin: 30px auto;
            padding: 20px;
            border: 2px solid #3498db;
            border-radius: 10px;
            max-width: 400px;
            background-color: #f8f9fa;
        }
        .value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #2c3e50;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <h1>micro:bit Accéléromètre en Temps Réel</h1>
    
    <button id="connectBtn">Connecter au micro:bit</button>
    
    <div id="data-container">
        <div>X: <span id="x-value" class="value">0</span></div>
        <div>Y: <span id="y-value" class="value">0</span></div>
        <div>Z: <span id="z-value" class="value">0</span></div>
    </div>

    <script>
        let port;
        const connectButton = document.getElementById('connectBtn');
        const xValue = document.getElementById('x-value');
        const yValue = document.getElementById('y-value');
        const zValue = document.getElementById('z-value');

        async function connectToMicrobit() {
            try {
                // Demande à l'utilisateur de sélectionner le port série
                port = await navigator.serial.requestPort();
                await port.open({ baudRate: 115200 });
                
                connectButton.textContent = "Connecté !";
                connectButton.style.backgroundColor = "#27ae60";
                
                // Configuration du lecteur de flux
                const reader = port.readable.getReader();
                
                let receivedData = '';
                
                while (true) {
                    const { value, done } = await reader.read();
                    
                    if (done) {
                        reader.releaseLock();
                        break;
                    }
                    
                    // Conversion des données reçues en texte
                    receivedData += new TextDecoder().decode(value);
                    
                    // Recherche de lignes complètes
                    const lines = receivedData.split('\n');
                    
                    if (lines.length > 1) {
                        // Garder les données incomplètes pour la prochaine fois
                        receivedData = lines.pop();
                        
                        // Traiter la dernière ligne complète
                        const lastLine = lines[lines.length - 1];
                        const values = lastLine.split(',');
                        
                        if (values.length === 3) {
                            // Mise à jour de l'interface
                            xValue.textContent = values[0];
                            yValue.textContent = values[1];
                            zValue.textContent = values[2];
                        }
                    }
                }
            } catch (error) {
                console.error("Erreur:", error);
                connectButton.textContent = "Erreur - Réessayer";
                connectButton.style.backgroundColor = "#e74c3c";
            }
        }

        // Gestionnaire d'événement pour le bouton
        connectButton.addEventListener('click', connectToMicrobit);
    </script>
</body>
</html>